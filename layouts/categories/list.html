{{ define "main" }}
<article class="markdown">
  <h1>Browse by Category</h1>
  
  {{ $categoryGroups := slice }}
  
  {{ range .Pages }}
    {{ $categoryName := .Title }}
    {{ $firstLetter := upper (substr $categoryName 0 1) }}
    
    {{ $categoryGroups = $categoryGroups | append (dict "letter" $firstLetter "page" . "name" $categoryName) }}
  {{ end }}
  
  {{ $currentLetter := "" }}
  {{ range sort $categoryGroups "name" }}
    {{ if ne .letter $currentLetter }}
      {{ if $currentLetter }}</ul>{{ end }}
      <h2>{{ .letter }}</h2>
      <ul>
      {{ $currentLetter = .letter }}
    {{ end }}
    <li>
      <a href="{{ .page.RelPermalink }}">{{ .page.Title }}</a>
      <span style="color: #666;">({{ len .page.Pages }} papers)</span>
    </li>
  {{ end }}
  {{ if $currentLetter }}</ul>{{ end }}
</article>
{{ end }}
